From 401e659055c098bd23129fc6b1c8373f9178a8f3 Mon Sep 17 00:00:00 2001
From: MSe1969 <mse1969@posteo.de>
Date: Sat, 28 Nov 2020 13:58:23 +0100
Subject: [PATCH] Fix for compatibility with hardened_malloc

Change-Id: I3fcbf65b0d4ac3c18b506e20c1cf6d41ae8d9d14
---
 openbsd-compat/openbsd-compat.h | 1 +
 openbsd-compat/openssl-compat.h | 1 +
 2 files changed, 2 insertions(+)

diff --git a/openbsd-compat/openbsd-compat.h b/openbsd-compat/openbsd-compat.h
index 865aaee5..2ac8b5d9 100644
--- a/openbsd-compat/openbsd-compat.h
+++ b/openbsd-compat/openbsd-compat.h
@@ -314,6 +314,7 @@ int	bcrypt_pbkdf(const char *, size_t, const u_int8_t *, size_t,
     u_int8_t *, size_t, unsigned int);
 #endif
 
+#define HAVE_EXPLICIT_BZERO
 #ifndef HAVE_EXPLICIT_BZERO
 void explicit_bzero(void *p, size_t n);
 #endif
diff --git a/openbsd-compat/openssl-compat.h b/openbsd-compat/openssl-compat.h
index a7981640..33f0e2e1 100644
--- a/openbsd-compat/openssl-compat.h
+++ b/openbsd-compat/openssl-compat.h
@@ -217,6 +217,7 @@ int RSA_meth_set_priv_dec(RSA_METHOD *meth, int (*priv_dec)(int flen,
 int RSA_meth_set_finish(RSA_METHOD *meth, int (*finish)(RSA *rsa));
 #endif /* HAVE_RSA_METH_SET_FINISH */
 
+#define HAVE_EVP_PKEY_GET0_RSA
 #ifndef HAVE_EVP_PKEY_GET0_RSA
 RSA *EVP_PKEY_get0_RSA(EVP_PKEY *pkey);
 #endif /* HAVE_EVP_PKEY_GET0_RSA */
-- 
2.11.0

